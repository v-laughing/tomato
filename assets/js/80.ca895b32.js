(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{1083:function(t,s,a){t.exports=a.p+"assets/img/web-page-timing.1016c5e3.png"},1084:function(t,s,a){t.exports=a.p+"assets/img/web-page-lcp.cdda224f.png"},1085:function(t,s,a){t.exports=a.p+"assets/img/web-page-fid.1d38500e.svg"},1423:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("页面加载节点图：")]),t._v(" "),e("p",[e("img",{attrs:{src:a(1083),alt:"timing"}})]),t._v(" "),e("p",[t._v("一些节点解释：")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("domInteractive")]),t._v("：浏览器已完成对 HTML 的解析并且 DOM 树构建完成。")]),t._v(" "),e("li",[e("strong",[t._v("domContentLoaded")]),t._v(": "),e("code",[t._v("domInteractive")]),t._v("之后，浏览器会触发"),e("code",[t._v("DOMContentLoaded")]),t._v("事件。")]),t._v(" "),e("li",[e("strong",[t._v("domComplete")]),t._v("：页面的所有处理都已完成，所有资源都已完成下载。此时加载旋转器停止旋转。")]),t._v(" "),e("li",[e("strong",[t._v("loadEvent")]),t._v("："),e("code",[t._v("domComplete")]),t._v("之后，浏览器会触发"),e("code",[t._v("onload")]),t._v("事件。")])]),t._v(" "),e("h2",{attrs:{id:"性能监控"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#性能监控"}},[t._v("#")]),t._v(" 性能监控")]),t._v(" "),e("p",[t._v("对网页前端性能进行实时监测、分析和优化，为了提高用户体验，减少加载时间，提高页面响应速度和性能。")]),t._v(" "),e("p",[t._v("主要包括以下几个方面：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("页面加载时间：包括DNS解析、TCP连接、请求响应，以及页面完全加载所需的时间。")])]),t._v(" "),e("li",[e("p",[t._v("资源加载性能：各个资源文件（如CSS、JavaScript、图片等）的加载时间和大小。可以通过优化资源加载顺序、合并文件、压缩文件大小等方式，提高资源加载性能。")])]),t._v(" "),e("li",[e("p",[t._v("页面渲染性能：包括DOM树构建、CSSOM树构建、渲染树构建阶段的耗时。可以通过减少DOM操作、优化CSS选择器、避免强制同步布局等方式，提高页面渲染性能。")])]),t._v(" "),e("li",[e("p",[t._v("用户交互性能：用户与页面的交互操作的响应时间，包括点击按钮、输入框输入等操作的反馈速度。可以通过优化JavaScript代码、减少页面重绘等方式，提高用户交互性能。")])])]),t._v(" "),e("p",[t._v("前端性能监控的实现在于通过指标量化上述的表现并上报数据，从这些数据中分析出页面可能存在的问题。")]),t._v(" "),e("p",[t._v("上面所述的可以大致分为两种类型：以用户为中心的性能指标与以技术为中心的性能指标。")]),t._v(" "),e("h3",{attrs:{id:"以用户为中心的性能指标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#以用户为中心的性能指标"}},[t._v("#")]),t._v(" 以用户为中心的性能指标")]),t._v(" "),e("p",[t._v("可以理解为直接体现出用户的使用体验的指标；对于用户体验来说，指标以下几个方面。")]),t._v(" "),e("ul",[e("li",[t._v("加载速度：衡量用户是否可以尽早感受到页面已经加载完成。")]),t._v(" "),e("li",[t._v("视觉稳定：衡量页面上的视觉变化对用户造成的负面影响大小。")]),t._v(" "),e("li",[t._v("交互延迟：衡量用户是否可以尽早感受到页面已经可以操作。")])]),t._v(" "),e("p",[t._v("目前 Google 定义了LCP、CLS 、FID等指标来衡量上述页面性能，已经成为了目前业界的标准；")]),t._v(" "),e("h4",{attrs:{id:"largest-contentful-paint"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#largest-contentful-paint"}},[t._v("#")]),t._v(" Largest Contentful Paint")]),t._v(" "),e("p",[t._v("最大内容绘制，从页面加载到"),e("strong",[t._v("可视区域内")]),t._v("最大的图像或文本块完成渲染的时间。衡量页面的"),e("strong",[t._v("加载速度")]),t._v("。")]),t._v(" "),e("blockquote",[e("p",[t._v("由于图片字体资源需要异步加载之后才进行渲染以及js代码会修改DOM结构等原因，最大渲染元素的确定需要在首屏渲染完成后。\n该值应控制在2.5s下")])]),t._v(" "),e("p",[e("img",{attrs:{src:a(1084),alt:"timing"}})]),t._v(" "),e("h4",{attrs:{id:"cumulative-layout-shift"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cumulative-layout-shift"}},[t._v("#")]),t._v(" Cumulative Layout Shift")]),t._v(" "),e("p",[t._v("累积布局偏移，测量整个页面生命周期内发生的所有意外布局偏移中"),e("strong",[t._v("最大一连串")]),t._v("的布局偏移分数。衡量页面视觉稳定性。")]),t._v(" "),e("blockquote",[e("p",[t._v("该值应控制在0.1下。")])]),t._v(" "),e("p",[t._v("一般地，可以通过下面方法降低CLS：")]),t._v(" "),e("ul",[e("li",[t._v("用"),e("code",[t._v("transform")]),t._v("调整元素的位置和大小。")]),t._v(" "),e("li",[t._v("在图像和视频元素上包含尺寸属性，或者通过CSS预留所需的空间。")]),t._v(" "),e("li",[t._v("一般情况下，不要在现有内容的上方插入内容。")])]),t._v(" "),e("h4",{attrs:{id:"first-input-delay"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#first-input-delay"}},[t._v("#")]),t._v(" First Input Delay")]),t._v(" "),e("p",[t._v("首次输入延迟，从用户第一次与页面交互（单击链接、点击按钮或使用由 JavaScript 驱动的自定义控件）到浏览器作出响应，并实际开始处理事件所经过的时间。衡量页面的交互延迟。")]),t._v(" "),e("blockquote",[e("p",[t._v("该值应控制在100ms下。\n当页面绘制完成，用户进行操作时，主线程恰好繁忙，此时该值就会较大。一种常见情况是页面通过异步加载了大型的JS文件，且在dom解析后执行，如"),e("code",[t._v("<script defer>")])])]),t._v(" "),e("h4",{attrs:{id:"其他指标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其他指标"}},[t._v("#")]),t._v(" 其他指标")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("白屏时间：从页面加载（"),e("code",[t._v("fetchStart")]),t._v("）到页面的首个像素完成渲染所需的时间，其中后者不包含默认的页面背景色。")])]),t._v(" "),e("li",[e("p",[t._v("灰屏时间，首次内容绘制，从页面加载到页面的任何部分完成渲染的时间。该值应控制在1.8s下。")])]),t._v(" "),e("li",[e("p",[t._v("可交互时间（Time to Interactive）：从页面加载到浏览器主线程执行完最后一个长任务的时间。衡量页面能够快速、可靠地响应用户的时间快慢。")])])]),t._v(" "),e("p",[e("img",{attrs:{src:a(1085),alt:"timing"}})]),t._v(" "),e("h2",{attrs:{id:"错误捕捉"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#错误捕捉"}},[t._v("#")]),t._v(" 错误捕捉")]),t._v(" "),e("h3",{attrs:{id:"js运行时错误"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#js运行时错误"}},[t._v("#")]),t._v(" js运行时错误")]),t._v(" "),e("p",[e("code",[t._v("window.onerror")]),t._v(" 和 "),e("code",[t._v("window.addEventListener('error')")]),t._v(" 都能捕获 "),e("code",[t._v("js")]),t._v(" "),e("strong",[t._v("运行时错误")]),t._v("，但是前者含有详细的堆栈信息，存在error.stack中。两者不会捕捉语法错误。")]),t._v(" "),e("blockquote",[e("p",[t._v("浏览器遇到语法或运行时错误时，将报告错误并中断当前脚本执行，但不中断其他脚本执行。")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// message：错误信息")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// source：发生错误的脚本URL")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// row：发生错误的行号")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// col：发生错误的列号")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// error：Error对象 (stack, message)")]),t._v("\nwindow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("message"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" row"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" col"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一般上报 message和error.stack")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对于第三方脚本可不上报，通过source判断")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 阻止异常继续向上抛出，否则控制台会显示 Uncaught Error: xxxxx")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" notdefined"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// no ")]),t._v("\nconsole"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("notdefined"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// yes")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" a "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// yes")]),t._v("\n")])])]),e("h4",{attrs:{id:"跨域问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#跨域问题"}},[t._v("#")]),t._v(" 跨域问题")]),t._v(" "),e("p",[t._v("当加载自不同域的脚本中发生"),e("strong",[t._v("语法错误")]),t._v("时，为避免信息泄露，语法错误的细节将不会报告，而是简单得报告"),e("code",[t._v("Script error.")]),t._v("（"),e("code",[t._v("message")]),t._v("为此值，"),e("code",[t._v("error")]),t._v("为空对象, "),e("code",[t._v("url")]),t._v("也不会有值）。")]),t._v(" "),e("p",[t._v("可以通过在 "),e("code",[t._v("<script>")]),t._v(" 使用 "),e("code",[t._v("crossorigin")]),t._v(" 属性并要求服务器发送适当的 CORS HTTP 响应头来解决。")]),t._v(" "),e("h3",{attrs:{id:"资源加载错误"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#资源加载错误"}},[t._v("#")]),t._v(" 资源加载错误")]),t._v(" "),e("p",[t._v("当一项资源加载或运行失败时，对应的元素会触发"),e("code",[t._v("error")]),t._v("事件，这些事件不会向上冒泡到window，不过能被"),e("code",[t._v("window.addEventListener")]),t._v("在捕获阶段捕获。")]),t._v(" "),e("p",[t._v("当然，由于"),e("code",[t._v("addEventListener")]),t._v("也能够捕获"),e("code",[t._v("js")]),t._v("运行时错误，需要过滤这部分，避免与"),e("code",[t._v("window.onerror")]),t._v("上报的重复。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("window"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("event"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" target "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" event"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("srcElement"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isElementTarget "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" target "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HTMLScriptElement")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" target "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HTMLLinkElement")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n      target "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HTMLImageElement")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" target "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HTMLVideoElement")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n      target "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HTMLAudioElement")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" target "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HTMLIFrameElement")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("isElementTarget"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// js error不再处理")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一般上报target.outerHTML")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("xxx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" // yes\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("xxx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token script"}}),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" // yes\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("xxx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v(" // yes\n\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token script"}},[e("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxxx'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// no")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// no")]),t._v("\n")])]),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),e("h3",{attrs:{id:"promise错误"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#promise错误"}},[t._v("#")]),t._v(" Promise错误")]),t._v(" "),e("p",[e("code",[t._v("Promise")]),t._v("实例从"),e("code",[t._v("pending")]),t._v("转变为"),e("code",[t._v("rejected")]),t._v("时，如果没有"),e("code",[t._v("catch")]),t._v("捕获，将抛出"),e("code",[t._v("Uncaught(in promise) Error")]),t._v("。可以通过"),e("code",[t._v("addEventListener('unhandledrejection',)")]),t._v("捕获该错误。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("window"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'unhandledrejection'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("event "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("event"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reason"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一般上报 event.reason.message || event.reason 和 event.reason.stack")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nPromise"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("reject")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise error'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// yes")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" a "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// yes")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxxx'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// yes")]),t._v("\n")])])]),e("h3",{attrs:{id:"vue错误"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vue错误"}},[t._v("#")]),t._v(" Vue错误")]),t._v(" "),e("p",[e("code",[t._v("Vue")]),t._v("通过"),e("code",[t._v("Vue.config.errorHandler")]),t._v("捕获所有Vue单文件组件或者Vue.extend继承的代码内的错误。")]),t._v(" "),e("p",[t._v("模板引用变量错误并不会被"),e("code",[t._v("errorHandler")]),t._v("捕获，而是被"),e("code",[t._v("warnHandler")]),t._v("捕获。")]),t._v(" "),e("h1",{attrs:{id:"页面优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#页面优化"}},[t._v("#")]),t._v(" 页面优化")]),t._v(" "),e("h2",{attrs:{id:"降低延迟"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#降低延迟"}},[t._v("#")]),t._v(" 降低延迟")]),t._v(" "),e("h3",{attrs:{id:"基于文档结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基于文档结构"}},[t._v("#")]),t._v(" 基于文档结构")]),t._v(" "),e("p",[t._v("优先安排关键网络资源，尽早分派请求。")]),t._v(" "),e("ul",[e("li",[t._v("CSS和JavaScript等重要资源应该尽早在文档中出现。")]),t._v(" "),e("li",[t._v("尽早交付CSS，从而解除渲染阻塞并让JavaScript执行。")]),t._v(" "),e("li",[t._v("推迟非关键性JavaScript，避免阻塞DOM和CSSOM构建。")])]),t._v(" "),e("h3",{attrs:{id:"推测性优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#推测性优化"}},[t._v("#")]),t._v(" 推测性优化")]),t._v(" "),e("p",[t._v("一般可利用"),e("code",[t._v("link")]),t._v("标签的"),e("code",[t._v("rel")]),t._v("属性来做到。")]),t._v(" "),e("ul",[e("li",[t._v("DNS预解析。"),e("code",[t._v("dns-prefetch")])]),t._v(" "),e("li",[t._v("TCP预连接。")]),t._v(" "),e("li",[t._v("延迟加载：减少页面首屏加载时需要请求的资源。")]),t._v(" "),e("li",[t._v("预加载：预先加载之后可能用到的资源。"),e("code",[t._v("prefetch")]),t._v("，"),e("code",[t._v("subresource")])]),t._v(" "),e("li",[t._v("预渲染：在隐藏的标签页中预先渲染整个页面。"),e("code",[t._v("prerender")])])]),t._v(" "),e("h2",{attrs:{id:"页面内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#页面内容"}},[t._v("#")]),t._v(" 页面内容")]),t._v(" "),e("ul",[e("li",[t._v("减少 HTTP 请求数：主要通过文件合并、css 雪碧图、使用 base64图片等。")]),t._v(" "),e("li",[t._v("避免重定向：这会导致多一次请求。")])]),t._v(" "),e("blockquote",[e("p",[t._v("最常见的重定向是：URL 末尾应该添加"),e("code",[t._v("/")]),t._v("但未添加。")])]),t._v(" "),e("ul",[e("li",[e("p",[t._v("资源缓存：对常用不变的资源进行缓存。")])]),t._v(" "),e("li",[e("p",[t._v("减少DOM元素数量。")])])]),t._v(" "),e("blockquote",[e("p",[t._v("不用表格，不用一堆"),e("code",[t._v("div")]),t._v("，尽量用伪元素。")])]),t._v(" "),e("ul",[e("li",[t._v("划分内容到不同域名：每个域的并行线程有限制（4~6）。")])]),t._v(" "),e("blockquote",[e("p",[t._v("同时为了避免DNS查询损耗，一般用2~4个域名。")])]),t._v(" "),e("ul",[e("li",[t._v("减少iframe：加载代价昂贵、阻塞页面 load 事件。")])]),t._v(" "),e("h2",{attrs:{id:"服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务器"}},[t._v("#")]),t._v(" 服务器")]),t._v(" "),e("ul",[e("li",[t._v("使用CDN：内容分发网络通过分散web服务器的地理位置，来提高响应速度。")])]),t._v(" "),e("blockquote",[e("p",[t._v("一般地，服务器选址是基于网络距离来考虑的。")])]),t._v(" "),e("ul",[e("li",[t._v("启用Gzip：压缩资源。")])]),t._v(" "),e("blockquote",[e("p",[t._v("HTTP/1.1开始，web客户端有支持压缩的请求头。")])]),t._v(" "),e("ul",[e("li",[t._v("获取数据用GET：POST请求时分成两步，先发送Http Header，再发送data。")]),t._v(" "),e("li",[t._v("避免空src或href：即使是空的，浏览器也可能会向服务器发起请求。")])]),t._v(" "),e("h2",{attrs:{id:"cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[t._v("#")]),t._v(" Cookie")]),t._v(" "),e("ul",[e("li",[t._v("减少 Cookie 大小。")]),t._v(" "),e("li",[t._v("静态资源使用无Cookie域名")])]),t._v(" "),e("h2",{attrs:{id:"css"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#css"}},[t._v("#")]),t._v(" CSS")]),t._v(" "),e("ul",[e("li",[t._v("把样式表放在"),e("code",[t._v("<head>")]),t._v("中，快点加载CSS文件，避免白屏。")]),t._v(" "),e("li",[t._v("不使用CSS表达式。")]),t._v(" "),e("li",[e("code",[t._v("<link>")]),t._v("替代"),e("code",[t._v("@import")]),t._v("：对于IE某些版本，@import的行为和放在页面底部一样。")])]),t._v(" "),e("h2",{attrs:{id:"js"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#js"}},[t._v("#")]),t._v(" JS")]),t._v(" "),e("ul",[e("li",[t._v("把脚本放在页面底部，或者考虑"),e("code",[t._v("defer")]),t._v("或"),e("code",[t._v("async")]),t._v("属性。")]),t._v(" "),e("li",[t._v("使用外部JavaScript和CSS，这些可以被浏览器缓存。")]),t._v(" "),e("li",[t._v("压缩JavaScript和CSS，去除空格或注释等。")]),t._v(" "),e("li",[t._v("减少DOM操作。")])]),t._v(" "),e("p",[t._v("参考："),e("a",{attrs:{href:"https://juejin.im/post/5b73ef38f265da281e048e51#heading-10",target:"_blank",rel:"noopener noreferrer"}},[t._v("《前端性能优化之雅虎35条军规》"),e("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);