(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{1179:function(t,e,n){"use strict";n(567)},1190:function(t,e,n){"use strict";n.r(e);var r=n(47),a=(n(99),n(14),n(40),n(231),n(128),n(96),n(72),n(228),n(1143),n(556)),o=n.n(a);n(1144),n(52),n(1146),n(1148),n(1153),n(1155),n(1156),n(1157),n(1159),n(1160),n(1161),n(1162),n(1163),n(1164),n(1165),n(1166),n(1167),n(1168),n(1169),n(1170),n(1171),n(1172),n(1173),n(1174),n(1175),n(1176),n(1177);function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"YYYY-MM-DD",e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0"),c=t.replace(/YYYY/g,n).replace(/MM/g,r).replace(/DD/g,a).replace(/HH/g,o).replace(/mm/g,s).replace(/ss/g,i);return c}function i(t){for(var e=window.atob(t),n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return new TextDecoder("utf-8").decode(n)}var c=n(1178),u=n.n(c),l="v-laughing",p="heads/master",g={data:function(){return{blogType:"logs",inputText:"",password:"",showImgLinks:!1,lastUploadedImgs:[],ciperText:"VTJGc2RHVmtYMTk4TVZBYmttQ0lFVUYxTmNEbDI3REVUdFhrTjZZVW5UUm8rTnlTcXFDTktnd2NyMEtkRFh5YkxmVFZYc0pRQVdYSS9FaHVNbGM5dHc9PQ=="}},mounted:function(){this.password=localStorage.getItem("GPOST_KEY"),this.lastUploadedImgs=JSON.parse(localStorage.getItem("GPOST_IMGS")||"[]")},computed:{accessToken:function(){return this.getToken()}},methods:{readFile:function(t){return new Promise((function(e,n){var r=new FileReader;r.onload=function(t){e(t.target.result.split(",")[1])},r.onerror=function(t){n(t)},r.readAsDataURL(t)}))},compressImg:function(t,e){return new Promise((function(n,r){new u.a(t,{quality:e,convertSize:2e6,success:function(t){n(t)},error:function(t){r(t)}})}))},uploadImage:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,a,o,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return");case 2:return e.octokit||(e.octokit=new window.Octokit({auth:e.getToken()})),n.prev=3,n.next=6,e.compressImg(t,.6);case 6:return r=n.sent,n.next=9,e.readFile(r);case 9:return a=n.sent,o="".concat(s(),"_").concat(t.name),i="docs/"+"assets/".concat(o),n.next=14,e.octokit.repos.createOrUpdateFileContents({owner:l,repo:"blog",path:i,message:"Upload file",content:a});case 14:e.lastUploadedImgs.unshift({name:o,mdUrl:"![img](/".concat(i,")  \n")}),e.lastUploadedImgs.length>5&&e.lastUploadedImgs.pop(),localStorage.setItem("GPOST_IMGS",JSON.stringify(e.lastUploadedImgs)),navigator.clipboard.writeText("![img](/".concat(i,")  \n")),alert("上传成功"),n.next=24;break;case 21:n.prev=21,n.t0=n.catch(3),console.error("Error: ",n.t0);case 24:case"end":return n.stop()}}),n,null,[[3,21]])})))()},handleFileUpload:function(t){var e=t.target.files[0];this.uploadImage(e)},getToken:function(){if(!this.password)return"";try{var t=o.a.enc.Base64.parse(this.ciperText).toString(o.a.enc.Utf8),e=o.a.AES.decrypt(t,this.password).toString(o.a.enc.Utf8);return localStorage.setItem("GPOST_KEY",this.password),e}catch(t){return""}},submit:function(){var t=this.getToken();if(t){if(this.octokit||(this.octokit=new window.Octokit({auth:t})),this.inputText){var e="docs/"+"".concat(this.blogType,"/").concat(s("YYYY"),".md");this.commitContent(e,this.inputText,this.blogType)}}else alert("error")},getFileContent:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.octokit.rest.repos.getContent({owner:l,repo:"blog",path:t,ref:p});case 3:return r=n.sent,n.abrupt("return",i(r.data.content));case 7:if(n.prev=7,n.t0=n.catch(0),404!==n.t0.status){n.next=13;break}return n.abrupt("return","");case 13:throw n.t0;case 14:case"end":return n.stop()}}),n,null,[[0,7]])})))()},getUpdateContent:function(t,e){var n="",r="## ".concat(s("MM"),"月");"logs"===this.blogType&&-1===t.lastIndexOf(r)&&(n+="".concat(r,"  \n\n"));var a=-1!==t.lastIndexOf(s());return t+(n+="".concat(a?"":"> ".concat(s(),"  \n\n")).concat(e,"  \n\n"))},commitContent:function(t,e,n){var a=this;return Object(r.a)(regeneratorRuntime.mark((function r(){var o,s,i,c,u,g;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,a.octokit.git.getRef({owner:l,repo:"blog",ref:p});case 3:return o=r.sent,s=o.data.object.sha,r.next=7,a.getFileContent(t);case 7:return i=r.sent,c=a.getUpdateContent(i,e),r.next=11,a.octokit.git.createTree({owner:l,repo:"blog",base_tree:s,tree:[{path:t,mode:"100644",type:"blob",content:c}]});case 11:return u=r.sent,r.next=14,a.octokit.git.createCommit({owner:l,repo:"blog",message:n,tree:u.data.sha,parents:[s]});case 14:return g=r.sent,r.next=17,a.octokit.git.updateRef({owner:l,repo:"blog",ref:p,sha:g.data.sha});case 17:alert("Commit Success"),a.inputText="",r.next=24;break;case 21:r.prev=21,r.t0=r.catch(0),alert(r.t0.message);case 24:case"end":return r.stop()}}),r,null,[[0,21]])})))()}}},d=(n(1179),n(7)),m=Object(d.a)(g,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.accessToken?n("div",[n("div",{staticClass:"flex items-center"},[n("input",{staticClass:"file-input",attrs:{type:"file",accept:"image/*"},on:{change:t.handleFileUpload}}),t._v(" "),n("div",{staticClass:"flex-shrink-0 ml-4 text-blue-600",on:{click:function(e){t.showImgLinks=!t.showImgLinks}}},[t._v("展开")])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showImgLinks,expression:"showImgLinks"}],staticClass:"mt-4"},t._l(t.lastUploadedImgs,(function(e,r){return n("div",{key:r,staticClass:"flex items-center mt-2"},[t._v("\n        "+t._s(e.name)+"\n        "),n("base-copy",{staticClass:"ml-4",attrs:{value:e.mdUrl}})],1)})),0),t._v(" "),n("base-opt",{staticClass:"mt-4",attrs:{options:["logs","opinions"]},model:{value:t.blogType,callback:function(e){t.blogType=e},expression:"blogType"}}),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputText,expression:"inputText"}],staticClass:"text-input mt-4",domProps:{value:t.inputText},on:{input:function(e){e.target.composing||(t.inputText=e.target.value)}}}),t._v(" "),n("button",{staticClass:"submit-button",on:{click:t.submit}},[t._v("Submit")])],1):n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"w-80 mb-4",attrs:{type:"text"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}})])}),[],!1,null,"3cd71381",null);e.default=m.exports},557:function(t,e){},567:function(t,e,n){}}]);