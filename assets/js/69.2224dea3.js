(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{1233:function(t,a,r){"use strict";r.r(a);var s=r(7),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("ul",[s("li",[s("RouterLink",{attrs:{to:"/cs/archit/msg-queue.html#一消息模型"}},[t._v("一、消息模型")]),t._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/cs/archit/msg-queue.html#点对点"}},[t._v("点对点")])],1),t._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cs/archit/msg-queue.html#发布订阅"}},[t._v("发布/订阅")])],1)])],1),t._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cs/archit/msg-queue.html#二使用场景"}},[t._v("二、使用场景")]),t._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/cs/archit/msg-queue.html#异步处理"}},[t._v("异步处理")])],1),t._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cs/archit/msg-queue.html#流量削锋"}},[t._v("流量削锋")])],1),t._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cs/archit/msg-queue.html#应用解耦"}},[t._v("应用解耦")])],1)])],1),t._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cs/archit/msg-queue.html#三可靠性"}},[t._v("三、可靠性")]),t._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/cs/archit/msg-queue.html#发送端的可靠性"}},[t._v("发送端的可靠性")])],1),t._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cs/archit/msg-queue.html#接收端的可靠性"}},[t._v("接收端的可靠性")])],1)])],1),t._v(" "),s("li",[s("RouterLink",{attrs:{to:"/cs/archit/msg-queue.html#参考资料"}},[t._v("参考资料")])],1)]),t._v(" "),s("h1",{attrs:{id:"一、消息模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、消息模型"}},[t._v("#")]),t._v(" 一、消息模型")]),t._v(" "),s("p",[t._v("请求不需要立即获得结果。")]),t._v(" "),s("h2",{attrs:{id:"点对点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#点对点"}},[t._v("#")]),t._v(" 点对点")]),t._v(" "),s("p",[t._v("消息生产者向消息队列中发送了一个消息之后，只能被一个消费者消费一次。")]),t._v(" "),s("p",[s("img",{attrs:{src:r(777),alt:"avatar"}}),s("br")]),t._v(" "),s("h2",{attrs:{id:"发布-订阅"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布-订阅"}},[t._v("#")]),t._v(" 发布/订阅")]),t._v(" "),s("p",[t._v("消息生产者向频道发送一个消息之后，多个消费者可以从该频道订阅到这条消息并消费。")]),t._v(" "),s("p",[s("img",{attrs:{src:r(778),alt:"avatar"}}),s("br")]),t._v(" "),s("p",[t._v("发布与订阅模式和观察者模式有以下不同：")]),t._v(" "),s("ul",[s("li",[t._v("观察者模式中，观察者和主题都知道对方的存在；而在发布与订阅模式中，生产者与消费者不知道对方的存在，它们之间通过频道进行通信。")]),t._v(" "),s("li",[t._v("观察者模式是同步的，当事件触发时，主题会调用观察者的方法，然后等待方法返回；而发布与订阅模式是异步的，生产者向频道发送一个消息之后，就不需要关心消费者何时去订阅这个消息，可以立即返回。")])]),t._v(" "),s("p",[s("img",{attrs:{src:r(779),alt:"avatar"}}),s("br")]),t._v(" "),s("h1",{attrs:{id:"二、使用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、使用场景"}},[t._v("#")]),t._v(" 二、使用场景")]),t._v(" "),s("h2",{attrs:{id:"异步处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#异步处理"}},[t._v("#")]),t._v(" 异步处理")]),t._v(" "),s("p",[t._v("发送者将消息发送给消息队列之后，不需要同步等待消息接收者处理完毕，而是立即返回进行其它操作。消息接收者从消息队列中订阅消息之后异步处理。")]),t._v(" "),s("p",[t._v("例如在注册流程中通常需要"),s("mark",[t._v("发送验证邮件")]),t._v("来确保注册用户身份的合法性，可以使用消息队列使发送验证邮件的操作异步处理，用户在填写完注册信息之后就可以完成注册，而将发送验证邮件这一消息发送到消息队列中。")]),t._v(" "),s("p",[t._v("只有在业务流程允许异步处理的情况下才能这么做，例如上面的注册流程中，如果要求用户对验证邮件进行点击之后才能完成注册的话，就不能再使用消息队列。")]),t._v(" "),s("h2",{attrs:{id:"流量削锋"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#流量削锋"}},[t._v("#")]),t._v(" 流量削锋")]),t._v(" "),s("p",[t._v("在高并发的场景下，如果短时间有大量的请求到达会压垮服务器。")]),t._v(" "),s("p",[t._v("可以将请求发送到消息队列中，服务器按照其处理能力从消息队列中订阅消息进行处理。")]),t._v(" "),s("h2",{attrs:{id:"应用解耦"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用解耦"}},[t._v("#")]),t._v(" 应用解耦")]),t._v(" "),s("p",[t._v("如果模块之间不直接进行调用，模块之间耦合度就会很低，那么修改一个模块或者新增一个模块对其它模块的影响会很小，从而实现可扩展性。")]),t._v(" "),s("p",[t._v("通过使用消息队列，一个模块只需要向消息队列中发送消息，其它模块可以选择性地从消息队列中订阅消息从而完成调用。")]),t._v(" "),s("h1",{attrs:{id:"三、可靠性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、可靠性"}},[t._v("#")]),t._v(" 三、可靠性")]),t._v(" "),s("h2",{attrs:{id:"发送端的可靠性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发送端的可靠性"}},[t._v("#")]),t._v(" 发送端的可靠性")]),t._v(" "),s("p",[t._v("发送端完成操作后一定能将消息成功发送到消息队列中。")]),t._v(" "),s("p",[t._v("实现方法：在本地数据库建一张消息表，将消息数据与业务数据保存在同一数据库实例里，这样就可以利用本地数据库的事务机制。事务提交成功后，将消息表中的消息转移到消息队列中，若转移消息成功则删除消息表中的数据，否则继续重传。")]),t._v(" "),s("h2",{attrs:{id:"接收端的可靠性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#接收端的可靠性"}},[t._v("#")]),t._v(" 接收端的可靠性")]),t._v(" "),s("p",[t._v("接收端能够从消息队列成功消费一次消息。")]),t._v(" "),s("p",[t._v("两种实现方法：")]),t._v(" "),s("ul",[s("li",[t._v("保证接收端处理消息的业务逻辑具有幂等性：只要具有幂等性，那么消费多少次消息，最后处理的结果都是一样的。")]),t._v(" "),s("li",[t._v("保证消息具有唯一编号，并使用一张日志表来记录已经消费的消息编号。")])]),t._v(" "),s("h1",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"http://developers-club.com/posts/270339/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Observer vs Pub-Sub"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://blog.csdn.net/lizhitao/article/details/47723105",target:"_blank",rel:"noopener noreferrer"}},[t._v("消息队列中点对点与发布订阅区别"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports},777:function(t,a,r){t.exports=r.p+"assets/img/image-20191212011250613.70ddce92.png"},778:function(t,a,r){t.exports=r.p+"assets/img/image-20191212011410374.cd8d4c18.png"},779:function(t,a,r){t.exports=r.p+"assets/img/image-20191212011747967.44efc7a1.png"}}]);