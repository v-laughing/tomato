(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{1178:function(t,e,n){"use strict";n(590)},1198:function(t,e,n){"use strict";n.r(e);var a=n(47),r=(n(99),n(71),n(14),n(39),n(230),n(128),n(96),n(1176),n(517)),o=n(1177),s=n.n(o),c="v-laughing",i="heads/master",u={data:function(){return{blogType:"logs",inputText:"",password:"",showImgLinks:!1,lastUploadedImgs:[],accessToken:""}},mounted:function(){var t=this;this.accessToken=localStorage.getItem("GPOST_KEY"),this.inputText=localStorage.getItem("GPOST_TEXT"),this.lastUploadedImgs=JSON.parse(localStorage.getItem("GPOST_IMGS")||"[]"),this.timer=setInterval((function(){t.inputText&&localStorage.setItem("GPOST_TEXT",t.inputText)}),1e4)},destroyed:function(){clearInterval(this.timer)},methods:{readFile:function(t){return new Promise((function(e,n){var a=new FileReader;a.onload=function(t){e(t.target.result.split(",")[1])},a.onerror=function(t){n(t)},a.readAsDataURL(t)}))},compressImg:function(t,e){return new Promise((function(n,a){new s.a(t,{quality:e,convertSize:2e6,success:function(t){n(t)},error:function(t){a(t)}})}))},uploadImage:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function n(){var a,o,s,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return");case 2:return e.octokit||(e.octokit=new window.Octokit({auth:e.accessToken})),n.prev=3,n.next=6,e.compressImg(t,.6);case 6:return a=n.sent,n.next=9,e.readFile(a);case 9:return o=n.sent,s="".concat(Object(r.c)(),"_").concat(t.name),i="assets/".concat(s),n.next=14,e.octokit.repos.createOrUpdateFileContents({owner:c,repo:"blog",path:"docs/"+i,message:"Upload file",content:o});case 14:e.lastUploadedImgs.unshift({name:s,mdUrl:"![img](../".concat(i,")  \n")}),e.lastUploadedImgs.length>5&&e.lastUploadedImgs.pop(),localStorage.setItem("GPOST_IMGS",JSON.stringify(e.lastUploadedImgs)),navigator.clipboard.writeText("![img](../".concat(i,")  \n")),alert("上传成功"),n.next=24;break;case 21:n.prev=21,n.t0=n.catch(3),console.error("Error: ",n.t0);case 24:case"end":return n.stop()}}),n,null,[[3,21]])})))()},handleFileUpload:function(t){var e=t.target.files[0];this.uploadImage(e)},inputPwd:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){var n,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.password){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,n=new window.Octokit({auth:t.password}),e.next=6,n.users.getAuthenticated();case 6:a=e.sent,(r=a.data)&&r.login&&(t.accessToken=t.password,localStorage.setItem("GPOST_KEY",t.password)),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(2);case 13:case"end":return e.stop()}}),e,null,[[2,11]])})))()},submit:function(){var t=this.accessToken;if(t){if(this.octokit||(this.octokit=new window.Octokit({auth:t})),this.inputText){var e="docs/"+"".concat(this.blogType,"/").concat(Object(r.c)("YYYY"),".md");this.commitContent(e,this.inputText,this.blogType)}}else alert("error")},getFileContent:function(t){var e=this;return Object(a.a)(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.octokit.rest.repos.getContent({owner:c,repo:"blog",path:t,ref:i});case 3:return a=n.sent,n.abrupt("return",Object(r.b)(a.data.content));case 7:if(n.prev=7,n.t0=n.catch(0),404!==n.t0.status){n.next=13;break}return n.abrupt("return","");case 13:throw n.t0;case 14:case"end":return n.stop()}}),n,null,[[0,7]])})))()},getUpdateContent:function(t,e){var n="",a="## ".concat(Object(r.c)("MM"),"月");-1===t.lastIndexOf(a)&&(n+="".concat(a,"  \n  \n"));var o=-1!==t.lastIndexOf(Object(r.c)());return t+(n+="".concat(o?"":"> ".concat(Object(r.c)(),"  \n  \n")).concat(e,"  \n  \n"))},commitContent:function(t,e,n){var r=this;return Object(a.a)(regeneratorRuntime.mark((function a(){var o,s,u,l,p,d;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,r.octokit.git.getRef({owner:c,repo:"blog",ref:i});case 3:return o=a.sent,s=o.data.object.sha,a.next=7,r.getFileContent(t);case 7:return u=a.sent,l=r.getUpdateContent(u,e),a.next=11,r.octokit.git.createTree({owner:c,repo:"blog",base_tree:s,tree:[{path:t,mode:"100644",type:"blob",content:l}]});case 11:return p=a.sent,a.next=14,r.octokit.git.createCommit({owner:c,repo:"blog",message:n,tree:p.data.sha,parents:[s]});case 14:return d=a.sent,a.next=17,r.octokit.git.updateRef({owner:c,repo:"blog",ref:i,sha:d.data.sha});case 17:alert("Commit Success"),r.inputText="",localStorage.setItem("GPOST_TEXT",r.inputText),a.next=25;break;case 22:a.prev=22,a.t0=a.catch(0),alert(a.t0.message);case 25:case"end":return a.stop()}}),a,null,[[0,22]])})))()}}},l=(n(1178),n(7)),p=Object(l.a)(u,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.accessToken?n("div",[n("div",{staticClass:"flex items-center"},[n("input",{staticClass:"file-input",attrs:{type:"file",accept:"image/*"},on:{change:t.handleFileUpload}}),t._v(" "),n("div",{staticClass:"flex-shrink-0 ml-4 text-blue-600",on:{click:function(e){t.showImgLinks=!t.showImgLinks}}},[t._v("展开")])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showImgLinks,expression:"showImgLinks"}],staticClass:"mt-4"},t._l(t.lastUploadedImgs,(function(e,a){return n("div",{key:a,staticClass:"flex items-center mt-2"},[n("span",{staticClass:"text-xs"},[t._v(t._s(e.mdUrl))]),t._v(" "),n("base-copy",{staticClass:"ml-4",attrs:{value:e.mdUrl}})],1)})),0),t._v(" "),n("base-opt",{staticClass:"mt-4",attrs:{options:["logs","opinions","funny","resources","ideas"]},model:{value:t.blogType,callback:function(e){t.blogType=e},expression:"blogType"}}),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputText,expression:"inputText"}],staticClass:"text-input mt-4",domProps:{value:t.inputText},on:{input:function(e){e.target.composing||(t.inputText=e.target.value)}}}),t._v(" "),n("button",{staticClass:"submit-button",on:{click:t.submit}},[t._v("Submit")])],1):n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"w-80 mb-4",attrs:{type:"text"},domProps:{value:t.password},on:{change:t.inputPwd,input:function(e){e.target.composing||(t.password=e.target.value)}}})])}),[],!1,null,"2adfd5af",null);e.default=p.exports},517:function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return o}));n(72),n(550),n(39),n(51),n(551),n(14),n(556),n(558),n(559),n(560),n(561),n(562),n(563),n(564),n(565),n(566),n(567),n(568),n(569),n(571),n(572),n(573),n(574),n(575),n(576),n(577),n(578),n(579),n(580),n(581);function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"YYYY-MM-DD",e=new Date,n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0"),c=String(e.getSeconds()).padStart(2,"0"),i=t.replace(/YYYY/g,n).replace(/MM/g,a).replace(/DD/g,r).replace(/HH/g,o).replace(/mm/g,s).replace(/ss/g,c);return i}function r(t){for(var e=window.atob(t),n=new Uint8Array(e.length),a=0;a<e.length;a++)n[a]=e.charCodeAt(a);return new TextDecoder("utf-8").decode(n)}function o(t){var e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}},590:function(t,e,n){}}]);