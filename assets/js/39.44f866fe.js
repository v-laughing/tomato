(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{1227:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"基本概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[t._v("#")]),t._v(" 基本概念")]),t._v(" "),n("p",[n("strong",[t._v("模板")]),t._v("：将 DOM 绑定至底层 Vue 实例的数据。")]),t._v(" "),n("p",[n("strong",[t._v("指令")]),t._v("：决定如何处理DOM元素。")]),t._v(" "),n("h2",{attrs:{id:"基本实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本实现"}},[t._v("#")]),t._v(" 基本实现")]),t._v(" "),n("p",[n("code",[t._v("view => model")]),t._v("：view上对dom结点的操作会触发相应的事件，在事件回调函数中实现对model值的赋值。\n"),n("code",[t._v("model => view")]),t._v("：model上对对象的赋值会触发对象的访问器事件，因而可以在此实现对view的更新。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(850),alt:"avatar"}}),n("br"),t._v(" "),n("img",{attrs:{src:a(851),alt:"avatar"}}),n("br")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("v-model")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    {{ text }}\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}},[n("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tel"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tdata"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\ttext"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello world'")]),t._v("\n  \t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[n("strong",[t._v("数据初始化")]),t._v("：解析"),n("code",[t._v("app")]),t._v("下的所有子节点，将所有的绑定值替换或赋值为model里的值。")]),t._v(" "),n("p",[n("strong",[t._v("数据劫持")]),t._v("：为有"),n("code",[t._v("v-model")]),t._v("属性的元素添加事件监听器，实现view=>model。")]),t._v(" "),n("p",[n("strong",[t._v("订阅/发布模式")]),t._v("：因为存在多个节点的内容对应同一个属性值，可以为每个节点设置一个订阅者对象，将这个订阅者对象加入这个属性的订阅者列表中。与此同时，属性的访问器成为发布者，从而实现model=>views。")]),t._v(" "),n("p",[t._v("由于数据劫持采用的是"),n("code",[t._v("Object.defineProperty()")]),t._v("，一些对属性的操作无法拦截，如通过下标方式修改数组数据或者给对象新增属性。")]),t._v(" "),n("blockquote",[n("p",[t._v("Vue3.0修复了这问题，其使用Proxy 对对象进行代理：监听的范围更广，封装更好。")])]),t._v(" "),n("h1",{attrs:{id:"变化侦听"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#变化侦听"}},[t._v("#")]),t._v(" 变化侦听")]),t._v(" "),n("p",[t._v("侦测数据的变化。当数据变化时，更新视图，即"),n("strong",[t._v("model")]),t._v("=>"),n("strong",[t._v("view")]),t._v("过程。vue主要通过[[front-end#数据绑定|数据劫持]]方式实现。主要有几点：")]),t._v(" "),n("ul",[n("li",[n("p",[n("strong",[t._v("行为拦截")]),t._v("：通过"),n("code",[t._v("Object.defineProperty")]),t._v("对对象的属性的"),n("code",[t._v("getter")]),t._v("和"),n("code",[t._v("setter")]),t._v("行为进行拦截。")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("依赖收集")]),t._v("：收集那些使用该数据的地方，在"),n("code",[t._v("getter")]),t._v("中进行，将其放入一个"),n("strong",[t._v("dep")]),t._v("对象，其中有包含依赖的数组"),n("strong",[t._v("subs")]),t._v("。")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("依赖抽象")]),t._v("：对那些使用数据的地方的抽象，称为"),n("code",[t._v("watcher")]),t._v("，包含数据变化时的操作，如回调或视图更新。新建时会自动被添加入"),n("strong",[t._v("subs")]),t._v("。")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("侦测封装")]),t._v("：实现一个"),n("strong",[t._v("Observer")]),t._v("类，对一个对象的所有属性递归地进行侦测。")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(852),alt:"avatar"}}),n("br")]),t._v(" "),n("h2",{attrs:{id:"object"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#object"}},[t._v("#")]),t._v(" Object")]),t._v(" "),n("p",[t._v("基本实现")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Observer")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("obj "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("Array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isArray")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("walk")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("walk")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" key "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineReactive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineReactive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" val "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'object'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Observer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" dep "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Dep")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineProperty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    enumerable"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    configurable"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      dep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("depend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 收集依赖")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" val\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newVal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" newVal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      val "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newVal\n      dep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("notify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 视图更新")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("strong",[t._v("问题")])]),t._v(" "),n("p",[t._v("采用"),n("code",[t._v("Object.defineProperty")]),t._v("，对对象地添加或删除属性行为无法进行拦截。")]),t._v(" "),n("h2",{attrs:{id:"数组"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数组"}},[t._v("#")]),t._v(" 数组")]),t._v(" "),n("p",[t._v("由于对象增删属性的行为无法拦截，因此对于数组这类频繁进行增删元素的对象而言，并不适合直接对其属性，即索引进行侦测。因而采取"),n("mark",[t._v("对数组方法的拦截")]),t._v("方式，即对"),n("mark",[t._v("原生方法的覆盖")]),t._v("。")]),t._v(" "),n("blockquote",[n("p",[t._v("两者不能共存，因为原生数组方法的内部含有对属性的访问与赋值。同时存在时访问器将被触发两次。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(853),alt:"avatar"}}),n("br")]),t._v(" "),n("p",[t._v("由于侦测是在整个数组上的，而非单个属性，因此"),n("strong",[t._v("Dep")]),t._v("对象放在"),n("strong",[t._v("Observer")]),t._v("中。")]),t._v(" "),n("p",[t._v("对于"),n("mark",[t._v("数组内的对象或数组")]),t._v("（不是侦听索引），同样需要进行侦听。")]),t._v(" "),n("p",[n("strong",[t._v("问题")])]),t._v(" "),n("p",[t._v("显然，基于上述设计，无法对数组的属性变化进行侦听，如")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),n("h2",{attrs:{id:"缺陷处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缺陷处理"}},[t._v("#")]),t._v(" 缺陷处理")]),t._v(" "),n("p",[t._v("Vue采用拓展api的方式（本质也是拦截）解决上述的问题，即")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("对数组的处理实际上通过新的"),n("code",[t._v("splice")]),t._v("方法代理。")]),t._v(" "),n("h2",{attrs:{id:"vue3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vue3"}},[t._v("#")]),t._v(" vue3")]),t._v(" "),n("h2",{attrs:{id:"watcher"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#watcher"}},[t._v("#")]),t._v(" Watcher")]),t._v(" "),n("p",[t._v("每个"),n("code",[t._v("watcher")]),t._v("对应一个组件，可观察多个数据，因此"),n("strong",[t._v("Dep")]),t._v("和"),n("code",[t._v("watcher")]),t._v("是"),n("strong",[t._v("多对多")]),t._v("关系。")]),t._v(" "),n("p",[t._v("新建"),n("code",[t._v("watcher")]),t._v("时，其被自动添加入对应的"),n("strong",[t._v("subs")]),t._v("列表中。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" expOrFn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deps "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可观察多个数据")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("depIds "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行this.getter()，会读取所有属性的值，函数内的或'a.b.c'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getter "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFunction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expOrFn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" expOrFn "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parsePath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expOrFn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cb "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cb\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 读取属性值")]),t._v("\n    window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" value\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行回调")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" oldValue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldValue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("api"),n("code",[t._v("vm.$watch")]),t._v("内部通过新建一个"),n("code",[t._v("watcher")]),t._v("对象实现。")]),t._v(" "),n("h1",{attrs:{id:"virtual-dom"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#virtual-dom"}},[t._v("#")]),t._v(" Virtual DOM")]),t._v(" "),n("p",[n("strong",[t._v("虚拟DOM")]),t._v("：用 JS 对象表示 DOM ，两者可以相互转换。")]),t._v(" "),n("p",[t._v("通过JS对象的缓存操作，可以减少对DOM的操作次数。大致过程：")]),t._v(" "),n("ol",[n("li",[t._v("将DOM用JS对象表示。主要是存储节点的类型，属性，子节点。")]),t._v(" "),n("li",[t._v("DOM状态变更时，重新构造一棵新的对象树。用"),n("code",[t._v("diff")]),t._v("算法找出新旧两树的不同。")]),t._v(" "),n("li",[t._v("根据得到的不同对DOM进行相应的操作。")])]),t._v(" "),n("h2",{attrs:{id:"vue方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vue方案"}},[t._v("#")]),t._v(" vue方案")]),t._v(" "),n("p",[t._v("可以对每个使用了数据的"),n("strong",[t._v("节点")]),t._v("绑定一个"),n("code",[t._v("watcher")]),t._v("，进而实现节点与数据的绑定，但这样做内存开销很大。")]),t._v(" "),n("p",[t._v("vue通过引入虚拟DOM，采取了一种折中的方案：每个"),n("strong",[t._v("组件")]),t._v("对应一个"),n("code",[t._v("watcher")]),t._v("。当数据发生变化时，所有依赖该数据的组件会通过"),n("strong",[t._v("虚拟DOM")]),t._v("去进行比对，进而更新渲染那些需要变化的节点。")]),t._v(" "),n("h2",{attrs:{id:"diff算法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diff算法"}},[t._v("#")]),t._v(" diff算法")]),t._v(" "),n("p",[t._v("虚拟DOM的应用关键在于"),n("strong",[t._v("diff")]),t._v("算法，其找出新旧两颗虚拟DOM树差异。vue采取的方式为"),n("strong",[t._v("同层比较")]),t._v("。")]),t._v(" "),n("h1",{attrs:{id:"模板编译"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模板编译"}},[t._v("#")]),t._v(" 模板编译")]),t._v(" "),n("p",[t._v("将模板编译，最终解析为一个渲染函数。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(854),alt:"avatar"}}),n("br")]),t._v(" "),n("p",[t._v("主要有三部分内容：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("将模板解析为抽象语法树"),n("strong",[t._v("AST")]),t._v("。")])]),t._v(" "),n("li",[n("p",[t._v("遍历AST标记静态节点。")])]),t._v(" "),n("li",[n("p",[t._v("使用AST生成"),n("strong",[t._v("代码字符串")]),t._v("，作为渲染函数的参数。")])])]),t._v(" "),n("p",[t._v("下面是一个例子。")]),t._v(" "),n("p",[t._v("模板")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("title")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Berwin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("@click")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("hello {{name}}"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("生成的代码字符串")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("_c")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// createElement")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'p'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      attrs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Berwin"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      on"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"click"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" c "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("_v")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("_s")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// _v: createTextVNode _s: toString")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("执行渲染函数，生成VNode。")]),t._v(" "),n("p",[t._v("当解析的节点为"),n("strong",[t._v("组件节点")]),t._v("时，会将其标签属性上解析出的数据当作参数传递给子组件。")]),t._v(" "),n("h1",{attrs:{id:"异步更新"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#异步更新"}},[t._v("#")]),t._v(" 异步更新")]),t._v(" "),n("p",[t._v("vue数据的变更不会立即执行DOM的更改，这些变更状态（"),n("code",[t._v("watcher")]),t._v("）被放入一个"),n("strong",[t._v("更新队列")]),t._v("中。这种策略可以减少对DOM的操作。大致过程为：")]),t._v(" "),n("ol",[n("li",[t._v("一开始，数据变更时，通过"),n("code",[t._v("nextTick")]),t._v("将对应的"),n("code",[t._v("watcher")]),t._v("放入队列"),n("code",[t._v("queue")]),t._v("，"),n("code",[t._v("queue")]),t._v("被放入更新队列"),n("code",[t._v("callbacks")]),t._v("中，同时开启一个"),n("strong",[t._v("宏或微任务")]),t._v("去执行更新队列。")])]),t._v(" "),n("blockquote",[n("p",[t._v("直到该任务执行之前的这段时间，发生的数据变更被"),n("mark",[t._v("去重地")]),t._v("压入队列，但不会再开启宏或微任务。")])]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[t._v("api调用"),n("code",[t._v("nextTick")]),t._v("时会将其回调函数压入"),n("code",[t._v("callbacks")]),t._v("。")])]),t._v(" "),n("li",[n("p",[t._v("执行"),n("code",[t._v("watcher")]),t._v("完成时，此时"),n("strong",[t._v("原生DOM")]),t._v("状态发生更改，但未在页面显示。")])]),t._v(" "),n("li",[n("p",[t._v("当当前事件循环结束时（即微队列的任务全部被执行），浏览器渲染页面，此时所有状态变更在页面上生效。")])])]),t._v(" "),n("h2",{attrs:{id:"nexttick"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nexttick"}},[t._v("#")]),t._v(" nextTick")]),t._v(" "),n("p",[t._v("从上面可以得知，"),n("code",[t._v("nextTick")]),t._v("的回调函数发生在DOM更新之后，既有：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'new message'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更改数据")]),t._v("\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textContent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'new message'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// false")]),t._v("\nVue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textContent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'new message'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("显然，根据其原理，可以使"),n("code",[t._v("nextTick")]),t._v("替换成"),n("code",[t._v("setTimeout")]),t._v("，从而达到一样的效果。")]),t._v(" "),n("h2",{attrs:{id:"宏-微任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#宏-微任务"}},[t._v("#")]),t._v(" 宏/微任务")]),t._v(" "),n("p",[n("code",[t._v("nextTick")]),n("mark",[t._v("默认采用微任务")]),t._v("，如果不行，则退为宏任务。具体的顺序为：")]),t._v(" "),n("p",[n("code",[t._v("promise.then")]),t._v(" -> "),n("code",[t._v("MutationObserver")]),t._v(" -> "),n("code",[t._v("setImmediate")]),t._v(" -> "),n("code",[t._v("setTimeout")])]),t._v(" "),n("h1",{attrs:{id:"生命周期"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生命周期"}},[t._v("#")]),t._v(" 生命周期")]),t._v(" "),n("h2",{attrs:{id:"初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[t._v("#")]),t._v(" 初始化")]),t._v(" "),n("p",[t._v("vue示例创建时，会进行一系列初始化，主要是：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 合并options")]),t._v("\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mergeOptions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 向实例挂载属性，如$parent, $_wacther等")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initLifecycle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将在父组件使用的v-on注册的事件添加到子组件的事件系统")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initEvents")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initRender")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// render 相关的属性，_c, $attrs")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("callHook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'beforeCreate'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在data/props前初始化inject, 获取父组件的provide值并初始化")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initInjections")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initProvide")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在data/props后初始化provide")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("callHook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'created'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$mount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("blockquote",[n("p",[t._v("以 $ 开头的属性是提供给用户使用的，以 _ 开头的属性是提供给内部使用的。")])]),t._v(" "),n("h3",{attrs:{id:"inject-provide"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#inject-provide"}},[t._v("#")]),t._v(" inject&provide")]),t._v(" "),n("p",[t._v("祖先组件通过"),n("code",[t._v("provide")]),t._v("注入数据，子孙组件可以通过"),n("code",[t._v("inject")]),t._v("这些数据。")]),t._v(" "),n("p",[n("code",[t._v("inject")]),t._v("在data前初始化，说明可以在data数据中使用"),n("code",[t._v("inject")]),t._v("的数据。")]),t._v(" "),n("h3",{attrs:{id:"state"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#state"}},[t._v("#")]),t._v(" state")]),t._v(" "),n("p",[t._v("初始化主要的数据属性："),n("code",[t._v("props")]),t._v(" -> "),n("code",[t._v("methods")]),t._v(" -> "),n("code",[t._v("data")]),t._v(" ->  "),n("code",[t._v("computed")]),t._v(" -> "),n("code",[t._v("watch")]),t._v("。")]),t._v(" "),n("p",[n("strong",[t._v("props")]),t._v("\n将父组件的"),n("code",[t._v("props")]),t._v("数据传给子组件"),n("strong",[t._v("规格化")]),t._v("的"),n("code",[t._v("props")]),t._v("属性，将最终的数据保存在"),n("code",[t._v("vm._props")]),t._v("中，通过代理实现"),n("code",[t._v("vm.x")]),t._v("访问"),n("code",[t._v("vm._props.x")]),t._v("。")]),t._v(" "),n("p",[n("strong",[t._v("methods")]),t._v("\n检查是否合法，遍历其属性，赋值给"),n("code",[t._v("vm")]),t._v("。")]),t._v(" "),n("p",[n("strong",[t._v("computed")]),t._v("\n主要特点是有"),n("strong",[t._v("数据缓存(存在watcher中)")]),t._v("，使用"),n("code",[t._v("watcher")]),t._v("来观察其中的数据变化。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(855),alt:"avatar"}}),n("br")]),t._v(" "),n("p",[t._v("这样的实现"),n("mark",[t._v("有个问题")]),t._v("：如果计算属性中的状态发生了变化，但计算属性的值并没有变，此时仍然会重新渲染组件。")]),t._v(" "),n("p",[t._v("改进的方案是："),n("strong",[t._v("计算属性")]),t._v("的"),n("code",[t._v("watcher")]),t._v("判断最终值是否改变，来决定是否通知"),n("strong",[t._v("组件")]),t._v("的"),n("code",[t._v("watcher")]),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"生命钩子"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生命钩子"}},[t._v("#")]),t._v(" 生命钩子")]),t._v(" "),n("p",[t._v("组件从创建到销毁的的过程，主要包括：开始创建、初始化数据、编译模板、挂载Dom→渲染、更新→渲染、销毁。")]),t._v(" "),n("p",[t._v("Vue提供了组件在生命周期各个阶段的钩子函数，以此在各个阶段实现一些操作。")]),t._v(" "),n("p",[n("strong",[t._v("beforeCreate")]),t._v("： 实例初始化前被触发，访问不到data数据。")]),t._v(" "),n("p",[n("strong",[t._v("created")]),t._v("：创建实例，完成数据初始化后。可访问 data、methods，但访问不到 $el 属性。")]),t._v(" "),n("blockquote",[n("p",[t._v("一般在此做一些页面初始化的工作，比如ajax 请求数据。")])]),t._v(" "),n("p",[n("strong",[t._v("beforeMount")]),t._v("：模板解析完成。")]),t._v(" "),n("p",[n("strong",[t._v("mounted")]),t._v("：组件元素创建完成，准备挂载。")]),t._v(" "),n("blockquote",[n("p",[t._v("并不一定添加到了DOM，可以用nextTick来保证这一点。")])]),t._v(" "),n("p",[n("strong",[t._v("beforeUpdate")]),t._v("： 数据更新将要对DOM做一些更改时。")]),t._v(" "),n("blockquote",[n("p",[t._v("对可能会被移除的元素做一些操作，比如移除事件监听器。")])]),t._v(" "),n("p",[n("strong",[t._v("updated")]),t._v("：在DOM的更改及渲染完毕后。")]),t._v(" "),n("p",[n("strong",[t._v("beforeDestroy")]),t._v("：组件即将被销毁并且从DOM上移除时。")]),t._v(" "),n("blockquote",[n("p",[t._v("销毁定时器、解绑全局事件等。")])]),t._v(" "),n("p",[n("strong",[t._v("destroyed")]),t._v("：组件被销毁后。")]),t._v(" "),n("blockquote",[n("p",[t._v("实例中的所有东西都会解除绑定，包括事件监听器，所有的子实例。")])]),t._v(" "),n("p",[t._v("使用 keep-alive时，还有两个钩子函数：分别是 activated 和 deactivated 。用 keep-alive 包裹的组件在切换时不会进行销毁，而是缓存到内存中并执行 deactivated 钩子函数，命中缓存渲染后会执行 actived 钩子函数。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(856),alt:"avatar"}}),n("br")]),t._v(" "),n("h3",{attrs:{id:"父子组件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#父子组件"}},[t._v("#")]),t._v(" 父子组件")]),t._v(" "),n("p",[t._v("父子间的生命周期执行顺序：对于某个过程，先执行父元素的前置钩子，再执行子元素的整套钩子，最后执行父元素的钩子。")]),t._v(" "),n("ul",[n("li",[t._v("加载渲染过程")])]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[t._v("父beforeCreate->父created->父beforeMount->子beforeCreate->子created->子beforeMount->子mounted->父mounted\n")])])]),n("ul",[n("li",[t._v("子组件更新过程")])]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[t._v("父beforeUpdate->子beforeUpdate->子updated->父updated\n")])])]),n("ul",[n("li",[t._v("父组件更新过程")])]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[t._v("父beforeUpdate->父updated\n")])])]),n("ul",[n("li",[t._v("销毁过程")])]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[t._v("父beforeDestroy->子beforeDestroy->子destroyed->父destroyed\n")])])])])}),[],!1,null,null,null);s.default=e.exports},850:function(t,s,a){t.exports=a.p+"assets/img/view-model.0c8d5132.png"},851:function(t,s,a){t.exports=a.p+"assets/img/vue-binding.5de7af21.png"},852:function(t,s,a){t.exports=a.p+"assets/img/vue-data-bind.1ff4e0c7.jpg"},853:function(t,s,a){t.exports=a.p+"assets/img/vue-array-bind.5dbf0e84.jpg"},854:function(t,s,a){t.exports=a.p+"assets/img/vue-make-path.3aefef41.jpg"},855:function(t,s,a){t.exports=a.p+"assets/img/vue-computed.e7e4816e.jpg"},856:function(t,s,a){t.exports=a.p+"assets/img/vue-lifecycle.564f2064.png"}}]);